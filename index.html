<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluasi Posyandu Remaja Kota Depok</title>
    <style>
        :root {
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --accent: #ff6b6b;
            --text: #333;
            --bg-light: #f4f7f6;
            --white: #ffffff;
            --success: #28a745;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            min-height: 100vh;
            color: var(--text);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 40px;
            position: relative;
            overflow: hidden;
        }

        /* Header Styles */
        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }

        .header h1 {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .header h2 {
            font-size: 1.1rem;
            color: #666;
            font-weight: 500;
        }

        /* Progress Bar */
        .progress-container {
            position: sticky;
            top: 0;
            background: var(--white);
            z-index: 100;
            padding: 10px 0 20px 0;
            margin-bottom: 20px;
        }

        .progress-bar {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .progress-text {
            font-size: 0.85rem;
            text-align: right;
            margin-top: 5px;
            color: #888;
        }

        /* Sections */
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            background: #f0f2ff;
            color: var(--primary);
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2rem;
            margin-bottom: 25px;
            font-weight: 700;
            border-left: 5px solid var(--primary);
        }

        .section-desc {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 20px;
            font-style: italic;
            background: #fff8e1;
            padding: 10px;
            border-radius: 8px;
        }

        /* Questions */
        .question-group {
            margin-bottom: 30px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 20px;
        }

        .question-label {
            display: block;
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 1.05rem;
        }

        .required-mark {
            color: var(--accent);
        }

        /* Inputs */
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Custom Radio/Checkbox */
        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-card {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-card:hover {
            background: #f9f9f9;
            border-color: #ddd;
        }

        .option-card.selected {
            background: #eef0ff;
            border-color: var(--primary);
            color: var(--primary);
            font-weight: 600;
        }

        .option-card input {
            margin-right: 12px;
            accent-color: var(--primary);
            transform: scale(1.2);
        }

        /* Scale (Likert) UX Improvement */
        .scale-container {
            display: flex;
            justify-content: space-between;
            gap: 5px;
            margin-top: 15px;
        }

        .scale-item {
            flex: 1;
            text-align: center;
        }

        .scale-input {
            display: none;
        }

        .scale-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 50px;
            border: 2px solid #eee;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            color: #888;
        }

        .scale-input:checked + .scale-label {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(78, 84, 200, 0.3);
        }

        .scale-legend {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
        }

        /* Navigation */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(78, 84, 200, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #555;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .error-msg {
            color: var(--accent);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        /* Success Screen */
        .success-screen {
            text-align: center;
            padding: 40px 20px;
        }
        .success-icon {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 20px;
        }

        /* Mobile Optimization */
        @media (max-width: 600px) {
            .container { padding: 20px; }
            .scale-container { 
                display: grid; 
                grid-template-columns: repeat(5, 1fr); 
                gap: 4px;
            }
            .scale-label { height: 40px; font-size: 0.9rem; }
            
            /* Specific fix for WHO-5 which has 6 options (0-5) */
            .scale-container.scale-6 {
                grid-template-columns: repeat(6, 1fr);
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        <div class="progress-text" id="progressText">Halaman 1</div>
    </div>

    <form id="questionnaireForm" onsubmit="return false;">
        <div id="formContent"></div>
    </form>

    <div class="nav-buttons" id="navButtons">
        <button class="btn btn-secondary" id="btnPrev" onclick="prevSection()">Kembali</button>
        <button class="btn btn-primary" id="btnNext" onclick="nextSection()">Lanjut</button>
    </div>
</div>

<script>
    // --- Data Definition ---
    const questionnaireData = [
        {
            id: "consent",
            title: "Pernyataan Kesediaan Responden",
            description: "Informasi Penelitian & Informed Consent",
            questions: [
                {
                    id: "info_text",
                    type: "html",
                    content: `
                        <p><strong>Judul Penelitian:</strong> Evaluasi Efektivitas Program Posyandu Remaja dalam Meningkatkan Kesadaran Mental dan Reproduksi Remaja di Kota Depok.</p>
                        <br>
                        <p>Kami mengundang Saudara/i untuk berpartisipasi. Partisipasi bersifat <strong>sukarela</strong>. Data Anda akan dijaga <strong>kerahasiaannya</strong>. Pengisian memakan waktu sekitar 25-30 menit.</p>
                    `
                },
                {
                    id: "consent_agreement",
                    text: "Apakah Anda bersedia berpartisipasi?",
                    type: "radio",
                    required: true,
                    options: [
                        { val: "setuju", label: "Saya SETUJU untuk berpartisipasi" },
                        { val: "tidak", label: "Saya TIDAK SETUJU" }
                    ]
                }
            ]
        },
        {
            id: "identitas",
            title: "Bagian I: Identitas Responden",
            description: "Silakan isi data diri Anda dengan benar.",
            questions: [
                { id: "nama", text: "Nama / Inisial", type: "text", required: true },
                { id: "usia", text: "Usia (Tahun)", type: "number", required: true },
                { id: "hp", text: "No. Handphone", type: "tel", required: true },
                { 
                    id: "jk", text: "Jenis Kelamin", type: "radio", required: true,
                    options: [{val: "L", label: "Laki-Laki"}, {val: "P", label: "Perempuan"}]
                },
                {
                    id: "pendidikan", text: "Tingkat Pendidikan", type: "radio", required: true,
                    hasOther: true,
                    options: [
                        {val: "smp", label: "SMP/sederajat"},
                        {val: "sma", label: "SMA/sederajat"}
                    ]
                },
                {
                    id: "status", text: "Status (Boleh pilih lebih dari satu)", type: "checkbox", required: true,
                    options: [
                        {val: "sekolah", label: "Masih Sekolah"},
                        {val: "lulus", label: "Sudah Lulus"},
                        {val: "bekerja", label: "Bekerja"},
                        {val: "tidak_bekerja", label: "Tidak Bekerja"}
                    ]
                },
                {
                    id: "kecamatan", text: "Kecamatan Tempat Tinggal", type: "select", required: true,
                    options: [
                        "Beji", "Bojongsari", "Cilodong", "Cimanggis", "Cinere", 
                        "Cipayung", "Limo", "Pancoran Mas", "Sawangan", "Sukmajaya", "Tapos", "Luar Depok"
                    ]
                },
                {
                    id: "lama_anggota", text: "Lama menjadi anggota Posyandu Remaja", type: "radio", required: true,
                    options: [
                        {val: "<6bulan", label: "< 6 bulan"},
                        {val: "6-12bulan", label: "6 – 12 bulan"},
                        {val: ">12bulan", label: "> 12 bulan"}
                    ]
                }
            ]
        },
        {
            id: "pengetahuan_kespro",
            title: "Bagian II: Pengetahuan Kesehatan Reproduksi",
            description: "Pilihlah satu jawaban yang menurut Anda paling tepat.",
            questions: [
                { id: "kespro_1", text: "1. Masa pubertas terjadi ketika tubuh mengalami perubahan fisik yang disebabkan oleh...", type: "radio", required: true, options: [{val:"a", label:"Penurunan hormon"}, {val:"b", label:"Peningkatan hormon tertentu"}, {val:"c", label:"Kekurangan gizi"}, {val:"d", label:"Infeksi"}] },
                { id: "kespro_2", text: "2. Kehamilan dapat terjadi jika...", type: "radio", required: true, options: [{val:"a", label:"Telah mengalami menstruasi"}, {val:"b", label:"Hanya setelah usia 18 tahun"}, {val:"c", label:"Adanya pertemuan sperma dan sel telur"}, {val:"d", label:"Setelah tes kehamilan positif"}] },
                { id: "kespro_3", text: "3. Kontrasepsi darurat paling efektif digunakan dalam waktu...", type: "radio", required: true, options: [{val:"a", label:"24 – 72 jam setelah berhubungan"}, {val:"b", label:"1 minggu setelah berhubungan"}, {val:"c", label:"Setelah menstruasi"}, {val:"d", label:"Kapan saja"}] },
                { id: "kespro_4", text: "4. Yang termasuk tanda bahaya infeksi menular seksual (IMS) adalah...", type: "radio", required: true, options: [{val:"a", label:"Bau mulut"}, {val:"b", label:"Keputihan berbau/nyeri saat BAK"}, {val:"c", label:"Demam batuk pilek"}, {val:"d", label:"Sakit kepala"}] },
                { id: "kespro_5", text: "5. Remaja membutuhkan edukasi kespro karena...", type: "radio", required: true, options: [{val:"a", label:"Mencegah kehamilan tidak diinginkan"}, {val:"b", label:"Menghindari perilaku berisiko"}, {val:"c", label:"Membuat keputusan sehat"}, {val:"d", label:"Semua benar"}] },
                { id: "kespro_6", text: "6. PMS (Premenstrual Syndrome) biasanya ditandai dengan...", type: "radio", required: true, options: [{val:"a", label:"Mual pusing 1 bulan"}, {val:"b", label:"Sedikit bercak darah"}, {val:"c", label:"Mood swing dan nyeri perut sebelum haid"}, {val:"d", label:"Energi berlebihan"}] },
                { id: "kespro_7", text: "7. Pernikahan dini berisiko karena...", type: "radio", required: true, options: [{val:"a", label:"Tubuh remaja belum siap hamil"}, {val:"b", label:"Tinggi badan berhenti"}, {val:"c", label:"Menyebabkan kematian"}, {val:"d", label:"Tidak memengaruhi apapun"}] },
                { id: "kespro_8", text: "8. Cara mencegah IMS paling efektif bagi remaja...", type: "radio", required: true, options: [{val:"a", label:"Menghindari perilaku berisiko"}, {val:"b", label:"Minum vitamin"}, {val:"c", label:"Olahraga"}, {val:"d", label:"Jauhi internet"}] },
                { id: "kespro_9", text: "9. Remaja perempuan dapat mengalami anemia karena...", type: "radio", required: true, options: [{val:"a", label:"Gula berlebih"}, {val:"b", label:"Kehilangan darah saat menstruasi"}, {val:"c", label:"Kurang minum"}, {val:"d", label:"Tidur siang"}] },
                { id: "kespro_10", text: "10. Salah satu mitos tentang menstruasi adalah...", type: "radio", required: true, options: [{val:"a", label:"Normal tiap 21-35 hari"}, {val:"b", label:"Nyeri ringan tidak wajar"}, {val:"c", label:"Proses biologis"}, {val:"d", label:"Tidak boleh keramas saat menstruasi"}] }
            ]
        },
        {
            id: "pengetahuan_mental",
            title: "Bagian III: Pengetahuan Kesehatan Mental",
            description: "Tentukan apakah pernyataan berikut Benar atau Salah.",
            questions: [
                { id: "mental_1", text: "1. Stres ringan adalah kondisi yang wajar dialami remaja.", type: "radio", required: true, options: [{val:"benar", label:"Benar"}, {val:"salah", label:"Salah"}] },
                { id: "mental_2", text: "2. Depresi hanya terjadi pada orang dewasa.", type: "radio", required: true, options: [{val:"benar", label:"Benar"}, {val:"salah", label:"Salah"}] },
                { id: "mental_3", text: "3. Gangguan cemas ditandai dengan rasa khawatir terus-menerus.", type: "radio", required: true, options: [{val:"benar", label:"Benar"}, {val:"salah", label:"Salah"}] },
                { id: "mental_4", text: "4. Sleep hygiene membantu mengurangi stres.", type: "radio", required: true, options: [{val:"benar", label:"Benar"}, {val:"salah", label:"Salah"}] },
                { id: "mental_5", text: "5. Perundungan (bullying) tidak berpengaruh pada kesehatan mental.", type: "radio", required: true, options: [{val:"benar", label:"Benar"}, {val:"salah", label:"Salah"}] },
                { id: "mental_6", text: "6. Konseling hanya boleh dilakukan jika kondisi sudah parah.", type: "radio", required: true, options: [{val:"benar", label:"Benar"}, {val:"salah", label:"Salah"}] },
                { id: "mental_7", text: "7. Menangis dapat menjadi cara tubuh melepaskan emosi.", type: "radio", required: true, options: [{val:"benar", label:"Benar"}, {val:"salah", label:"Salah"}] },
                { id: "mental_8", text: "8. Kesedihan > 2 minggu adalah tanda depresi.", type: "radio", required: true, options: [{val:"benar", label:"Benar"}, {val:"salah", label:"Salah"}] },
                { id: "mental_9", text: "9. Remaja tidak boleh pergi ke psikolog.", type: "radio", required: true, options: [{val:"benar", label:"Benar"}, {val:"salah", label:"Salah"}] },
                { id: "mental_10", text: "10. Mengurangi gadget sebelum tidur dapat meningkatkan kualitas tidur.", type: "radio", required: true, options: [{val:"benar", label:"Benar"}, {val:"salah", label:"Salah"}] }
            ]
        },
        {
            id: "sikap",
            title: "Bagian IV: Sikap (Attitude)",
            description: "Keterangan: 1 = Sangat Tidak Setuju, 5 = Sangat Setuju",
            questions: [
                "Saya merasa informasi kespro penting bagi remaja.",
                "Saya percaya menjaga kesehatan mental sama pentingnya dengan fisik.",
                "Remaja berhak mendapatkan edukasi kespro yang benar.",
                "Saya merasa nyaman membicarakan topik kesehatan mental.",
                "Saya tidak malu mencari bantuan saat masalah emosional.",
                "Remaja harus tahu mencegah perilaku seksual berisiko.",
                "Penting mengenali tanda stres pada diri sendiri.",
                "Informasi kespro harus berasal dari sumber terpercaya.",
                "Aktivitas fisik dapat membantu kesehatan mental.",
                "Aplikasi edukasi membantu memahami topik sensitif."
            ].map((q, i) => ({ id: `sikap_${i+1}`, text: `${i+1}. ${q}`, type: "scale", min:1, max:5, required: true }))
        },
        {
            id: "perilaku",
            title: "Bagian V: Perilaku",
            description: "Jawablah sesuai kebiasaan Anda.",
            questions: [
                { id: "perilaku_1", text: "1. Dalam 1 bulan terakhir, seberapa sering Anda merasa stres?", type: "radio", required: true, options: [{val:"0", label:"Tidak pernah"}, {val:"1", label:"1-3 kali"}, {val:"2", label:"> 3 kali"}, {val:"3", label:"Hampir tiap hari"}] },
                { id: "perilaku_2", text: "2. Dalam 2 minggu terakhir, apakah Anda pernah kesulitan tidur?", type: "radio", required: true, options: [{val:"ya", label:"Ya"}, {val:"tidak", label:"Tidak"}] },
                { id: "perilaku_3", text: "3. Seberapa sering Anda berolahraga?", type: "radio", required: true, options: [{val:"0", label:"Tidak pernah"}, {val:"1", label:"1x/minggu"}, {val:"2", label:"2-3x/minggu"}, {val:"3", label:">3x/minggu"}] },
                { id: "perilaku_4", text: "4. Saya menghindari perilaku seksual berisiko.", type: "radio", required: true, options: [{val:"ya", label:"Ya"}, {val:"tidak", label:"Tidak"}] },
                { id: "perilaku_5", text: "5. Pernah berkonsultasi masalah pribadi ke orang dewasa terpercaya.", type: "radio", required: true, options: [{val:"ya", label:"Ya"}, {val:"tidak", label:"Tidak"}] },
                { id: "perilaku_6", text: "6. Memeriksa informasi kesehatan sebelum mempercayainya.", type: "radio", required: true, options: [{val:"ya", label:"Ya"}, {val:"tidak", label:"Tidak"}] },
                { id: "perilaku_7", text: "7. Menerapkan strategi coping (menulis, relaksasi, napas dalam).", type: "radio", required: true, options: [{val:"0", label:"Tidak pernah"}, {val:"1", label:"Kadang-kadang"}, {val:"2", label:"Sering"}] },
                { id: "perilaku_8", text: "8. Tidur minimal 7 jam per hari.", type: "radio", required: true, options: [{val:"ya", label:"Ya"}, {val:"tidak", label:"Tidak"}] },
                { id: "perilaku_9", text: "9. Mengurangi gadget sebelum tidur.", type: "radio", required: true, options: [{val:"ya", label:"Ya"}, {val:"tidak", label:"Tidak"}] },
                { id: "perilaku_10", text: "10. Menjaga kebersihan diri saat menstruasi/pubertas.", type: "radio", required: true, options: [{val:"ya", label:"Ya"}, {val:"tidak", label:"Tidak"}] }
            ]
        },
        {
            id: "self_efficacy",
            title: "Bagian VI: Kemampuan Diri (Self-Efficacy)",
            description: "Keterangan: 1 = Sangat Tidak Setuju, 5 = Sangat Setuju",
            questions: [
                "Mampu memahami info kesehatan dari aplikasi/online.",
                "Mampu mengambil keputusan sehat terkait pergaulan.",
                "Percaya diri mencari bantuan bila ada masalah emosional.",
                "Mampu mengelola stres ringan dengan teknik yang dipelajari.",
                "Mampu mengenali hoaks kesehatan.",
                "Yakin dapat menerapkan perilaku sehat.",
                "Percaya diri bicara kespro dengan orang dewasa.",
                "Mampu menjaga kesehatan diri secara mandiri.",
                "Yakin dapat mengontrol gadget.",
                "Mampu meminta bantuan saat menghadapi masalah."
            ].map((q, i) => ({ id: `se_${i+1}`, text: `${i+1}. ${q}`, type: "scale", min:1, max:5, required: true }))
        },
        {
            id: "who5",
            title: "Bagian VII: WHO-5 Well Being Index",
            description: "Dalam 2 minggu terakhir. (0 = Tidak Pernah, 5 = Selalu)",
            questions: [
                "Saya merasa ceria dan bersemangat.",
                "Saya merasa tenang dan damai.",
                "Saya merasa aktif dan penuh energi.",
                "Saya bangun pagi dengan perasaan segar.",
                "Saya merasa kegiatan sehari-hari memuaskan."
            ].map((q, i) => ({ id: `who_${i+1}`, text: `${i+1}. ${q}`, type: "scale", min:0, max:5, required: true }))
        }
    ];

    let currentStep = 0;
    const formData = {};

    // --- Rendering Functions ---

    function init() {
        renderSection(currentStep);
        updateProgress();
    }

    function renderSection(index) {
        const section = questionnaireData[index];
        const container = document.getElementById('formContent');
        container.innerHTML = ''; // Clear previous

        // Header
        const sectionDiv = document.createElement('div');
        sectionDiv.className = 'section active';
        
        sectionDiv.innerHTML = `
            <div class="section-title">${section.title}</div>
            ${section.description ? `<div class="section-desc">${section.description}</div>` : ''}
        `;

        // Questions
        section.questions.forEach(q => {
            const qGroup = document.createElement('div');
            qGroup.className = 'question-group';

            // HTML content type (for info only)
            if (q.type === 'html') {
                qGroup.innerHTML = q.content;
            } else {
                // Label
                const label = document.createElement('label');
                label.className = 'question-label';
                label.innerHTML = `${q.text} ${q.required ? '<span class="required-mark">*</span>' : ''}`;
                qGroup.appendChild(label);

                // Inputs
                if (q.type === 'text' || q.type === 'number' || q.type === 'tel') {
                    qGroup.innerHTML += `<input type="${q.type}" id="${q.id}" class="form-input" value="${formData[q.id] || ''}" onchange="saveData('${q.id}', this.value)">`;
                } 
                else if (q.type === 'select') {
                    let opts = `<option value="">-- Pilih --</option>`;
                    q.options.forEach(opt => {
                        const sel = formData[q.id] === opt ? 'selected' : '';
                        opts += `<option value="${opt}" ${sel}>${opt}</option>`;
                    });
                    qGroup.innerHTML += `<select id="${q.id}" class="form-select" onchange="saveData('${q.id}', this.value)">${opts}</select>`;
                }
                else if (q.type === 'radio' || q.type === 'checkbox') {
                    const grid = document.createElement('div');
                    grid.className = 'options-grid';
                    q.options.forEach(opt => {
                        const isChecked = q.type === 'checkbox' 
                            ? (formData[q.id] || []).includes(opt.val)
                            : formData[q.id] === opt.val;
                        
                        grid.innerHTML += `
                            <label class="option-card ${isChecked ? 'selected' : ''}" onclick="toggleSelect(this, '${q.type}', '${q.id}', '${opt.val}')">
                                <input type="${q.type}" name="${q.id}" value="${opt.val}" ${isChecked ? 'checked' : ''} style="pointer-events:none">
                                <span>${opt.label}</span>
                            </label>
                        `;
                    });
                    if (q.hasOther) {
                        grid.innerHTML += `<input type="text" class="form-input" placeholder="Lainnya (sebutkan)..." style="margin-top:10px" onchange="saveData('${q.id}_other', this.value)" value="${formData[q.id+'_other'] || ''}">`;
                    }
                    qGroup.appendChild(grid);
                }
                else if (q.type === 'scale') {
                    const min = q.min;
                    const max = q.max;
                    let scales = `<div class="scale-legend"><span>${min===0?'Tidak Pernah':'Sangat Tidak Setuju'}</span><span>${min===0?'Selalu':'Sangat Setuju'}</span></div>`;
                    scales += `<div class="scale-container ${max === 5 && min === 0 ? 'scale-6' : ''}">`; // Add class for 6 cols if WHO-5
                    
                    for (let i = min; i <= max; i++) {
                        const checked = formData[q.id] == i ? 'checked' : '';
                        scales += `
                            <div class="scale-item">
                                <input type="radio" name="${q.id}" id="${q.id}_${i}" value="${i}" class="scale-input" ${checked} onchange="saveData('${q.id}', '${i}')">
                                <label for="${q.id}_${i}" class="scale-label">${i}</label>
                            </div>
                        `;
                    }
                    scales += `</div>`;
                    qGroup.innerHTML += scales;
                }
                
                // Error Msg holder
                qGroup.innerHTML += `<div class="error-msg" id="err_${q.id}">Wajib diisi</div>`;
            }
            sectionDiv.appendChild(qGroup);
        });

        container.appendChild(sectionDiv);

        // Buttons
        document.getElementById('btnPrev').style.display = index === 0 ? 'none' : 'inline-block';
        document.getElementById('btnNext').innerText = index === questionnaireData.length - 1 ? 'Kirim' : 'Lanjut';
    }

    // --- Interaction Logic ---

    function toggleSelect(el, type, id, val) {
        const input = el.querySelector('input');
        
        if (type === 'radio') {
            // Deselect siblings visual
            el.parentElement.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            input.checked = true;
            saveData(id, val);
        } else {
            // Checkbox
            input.checked = !input.checked;
            if (input.checked) el.classList.add('selected');
            else el.classList.remove('selected');
            
            // Handle array data
            let current = formData[id] || [];
            if (input.checked) current.push(val);
            else current = current.filter(v => v !== val);
            saveData(id, current);
        }
    }

    function saveData(key, val) {
        formData[key] = val;
        // Remove error if exists
        const err = document.getElementById(`err_${key}`);
        if(err) err.style.display = 'none';
    }

    function validateCurrentStep() {
        const section = questionnaireData[currentStep];
        let valid = true;
        
        // Check Consent specifically
        if (section.id === 'consent') {
            if (formData['consent_agreement'] !== 'setuju') {
                alert("Maaf, Anda harus menyetujui pernyataan kesediaan untuk melanjutkan.");
                return false;
            }
        }

        section.questions.forEach(q => {
            if (q.required && q.type !== 'html') {
                const val = formData[q.id];
                const err = document.getElementById(`err_${q.id}`);
                
                if (!val || (Array.isArray(val) && val.length === 0)) {
                    if(err) err.style.display = 'block';
                    valid = false;
                    
                    // Simple scroll to error
                    if(!document.querySelector('.error-active')) {
                        err.parentElement.scrollIntoView({behavior: 'smooth', block: 'center'});
                        err.classList.add('error-active');
                    }
                }
            }
        });

        // clear error flags
        document.querySelectorAll('.error-active').forEach(e => e.classList.remove('error-active'));
        return valid;
    }

    function nextSection() {
        if (!validateCurrentStep()) return;

        if (currentStep < questionnaireData.length - 1) {
            currentStep++;
            renderSection(currentStep);
            updateProgress();
            window.scrollTo(0, 0);
        } else {
            submitForm();
        }
    }

    function prevSection() {
        if (currentStep > 0) {
            currentStep--;
            renderSection(currentStep);
            updateProgress();
            window.scrollTo(0, 0);
        }
    }

    function updateProgress() {
        const percent = ((currentStep + 1) / questionnaireData.length) * 100;
        document.getElementById('progressBar').style.width = `${percent}%`;
        document.getElementById('progressText').innerText = `Bagian ${currentStep + 1} dari ${questionnaireData.length}`;
    }

    // --- Updated Submission Logic ---
    function submitForm() {
        const btn = document.getElementById('btnNext');
        const originalText = btn.innerText;
        btn.innerText = 'Mengirim...';
        btn.disabled = true;

        // Your specific Google Apps Script URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyKkOsZLmrJ7jxxjxD1bfBOojMwZbvY1QQTzkqe4ugfjnXSp7nFqHKMHBrheclxPc09/exec'; 

        // Add timestamp for the data
        formData['timestamp'] = new Date().toISOString();

        console.log("Sending data to:", SCRIPT_URL);

        fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', // Critical for Google Sheets
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        })
        .then(() => {
            // Google Sheets "no-cors" mode doesn't return a readable JSON response.
            // If it reaches here, the request was successfully SENT.
            document.querySelector('.container').innerHTML = `
                <div class="success-screen">
                    <div class="success-icon">✓</div>
                    <h2>Terima Kasih!</h2>
                    <p>Jawaban Anda telah berhasil disimpan.</p>
                    <p>Partisipasi Anda sangat berharga bagi evaluasi program Posyandu Remaja Kota Depok.</p>
                    <button class="btn btn-primary" onclick="location.reload()" style="margin-top:20px;">Isi Lagi</button>
                </div>
            `;
        })
        .catch(error => {
            console.error('Error!', error.message);
            alert('Terjadi kesalahan saat mengirim data. Silakan coba lagi.');
            btn.innerText = originalText;
            btn.disabled = false;
        });
    }

    // Start
    init();

</script>

</body>

</html>
